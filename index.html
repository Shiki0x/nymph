<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NYMPH – Habit Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }

    input, textarea, button {
      width: 100%;
      margin: 6px 0;
      padding: 8px;
      font-size: 14px;
    }

    button {
      cursor: pointer;
      background: #4caf50;
      border: none;
      color: black;
      font-weight: bold;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      background: #222;
      margin: 6px 0;
      padding: 10px;
    }
  </style>
</head>

<body>
  <h1>NYMPH</h1>
  <p>Simple habit logger (dev UI)</p>

  <!-- USER ID -->
  <label>User ID</label>
  <input id="userIdInput" type="number" value="1" min="1" />

  <!-- HABIT -->
  <label>Habit</label>
  <input id="habitInput" placeholder="gym, study, meditate..." />

  <!-- CATEGORY -->
  <label>Category</label>
  <input id="categoryInput" placeholder="fitness, study, mental..." />

  <!-- NOTES -->
  <label>Notes</label>
  <textarea id="notesInput" placeholder="optional notes..."></textarea>

  <!-- COMPLETED -->
  <label>
    <input id="completedInput" type="checkbox" />
    Completed
  </label>

  <button onclick="logHabit()">Log Habit</button>

  <h2>Habits</h2>
  <ul id="habitList"></ul>

  <script>
    // Backend base URL
    const API_BASE = "http://127.0.0.1:8000";

    // Grab elements once
    const userIdInput = document.getElementById("userIdInput");
    const habitInput = document.getElementById("habitInput");
    const categoryInput = document.getElementById("categoryInput");
    const notesInput = document.getElementById("notesInput");
    const completedInput = document.getElementById("completedInput");
    const habitList = document.getElementById("habitList");

    async function logHabit() {
      const userId = userIdInput.value;
      const habit = habitInput.value.trim();
      const completed = completedInput.checked;
      const category = categoryInput.value.trim();
      const notes = notesInput.value.trim();

      if (!habit) {
        alert("Habit is required");
        return;
      }

      // Build URL with query params (matches FastAPI)
      const url = new URL(`${API_BASE}/log-habit`);
      url.searchParams.set("user_id", userId);
      url.searchParams.set("habit", habit);
      url.searchParams.set("completed", completed);

      if (category) url.searchParams.set("category", category);
      if (notes) url.searchParams.set("notes", notes);

      await fetch(url, { method: "POST" });

      // Clear inputs
      habitInput.value = "";
      categoryInput.value = "";
      notesInput.value = "";
      completedInput.checked = false;

      refreshHabits();
    }

    async function refreshHabits() {
      const userId = userIdInput.value;
      const res = await fetch(`${API_BASE}/habits?user_id=${userId}`);
      const data = await res.json();

      habitList.innerHTML = "";

      data.forEach(item => {
        const li = document.createElement("li");

        const category = item.category ? ` (${item.category})` : "";
        const notes = item.notes ? ` — ${item.notes}` : "";
        const status = item.completed ? "✔️" : "❌";

        li.textContent = `${status} ${item.habit}${category}${notes}`;
        habitList.appendChild(li);
      });
    }

    // Load habits on page load
    refreshHabits();
  </script>
</body>
</html>
